# Claude Mistakes Log

This file tracks coding mistakes to avoid repeating them. Not committed to git.

## 2025-08-26 - Calendar Buttons Implementation

### 1. Terrible Error Handling - "User" Fallback
**Mistake:** Used `|| 'User'` fallback for undefined realName
```ts
userNames: [userMap.get(message.userId)?.realName || 'User']
```
**Why wrong:** 
- Message fails to send (no user named 'User')
- Could send to wrong person if someone named 'User' exists
- Masks real data problems

**Correct approach:** Fail fast with descriptive error
```ts
const userName = userMap.get(message.userId)?.realName
if (!userName) {
  throw new Error(`User ${message.userId} has no realName in userMap`)
}
```
**Rule:** Never use generic fallbacks for user identification. Always throw errors.

### 2. Over-exporting Functions
**Mistake:** Exported internal helper functions unnecessarily
- `shouldSuppressCalendarPrompt`
- `hasUserBeenPrompted` 
- `findActiveTopicsForUser`

**Why wrong:** Creates false public API, harder to refactor
**Rule:** Only export what's actually used externally

### 3. Unnecessary Variable Assignments
**Mistake:** Created `messageToSend` variable when `messageGroup.text` was cleaner
**Why wrong:** Extra complexity for no benefit
**Rule:** Don't create variables unless they add clarity or avoid repetition

### 4. Architectural Flaw - Shotgun Workflow Continuation
**Mistake:** Sent continuation messages to ALL active topics for user
```ts
for (const topic of activeTopics) {
  // Send message to each topic - WRONG
}
```
**Why wrong:** User gets spammed, wrong topics get continued
**Correct approach:** Pass topicId in OAuth state, continue only that specific topic
**Rule:** Always maintain context specificity, never broadcast when targeting is needed

### 5. Slack Message Pattern - ack() + postMessage()
**Mistake:** Used separate `ack()` and `client.chat.postMessage()`
**Why wrong:** Two operations when one suffices
**Correct approach:** `ack({ text: "message" })`
**Rule:** Use Slack's built-in patterns rather than composing primitives

### 6. Over-Exporting Functions
**Mistake:** Exported internal helper functions unnecessarily
```ts
// WRONG: Exported functions only used within the same file
export async function shouldSuppressCalendarPrompt(...) 
export async function hasUserBeenPrompted(...)
export async function findActiveTopicsForUser(...)
```
**Why wrong:** Creates false public API, harder to refactor, suggests external use
**Rule:** Follow Ben's pattern - only export what other files actually import
```ts
// CORRECT: Internal helpers are not exported
async function shouldSuppressCalendarPrompt(...)
async function hasUserBeenPrompted(...)
```

---

## General Patterns to Avoid
- Generic string fallbacks for user data
- Over-exporting internal functions  
- Creating variables that don't add value
- Broadcasting when targeting is needed
- Composing primitives when built-in patterns exist